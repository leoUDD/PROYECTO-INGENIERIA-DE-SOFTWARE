{% load static %}
{% include "atajos.html" %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Misi√≥n Emprende UDD ‚Äî LEGO</title>
  <link rel="stylesheet" href="{% static 'css/estilo_lego.css' %}">
</head>
<body>
  <main class="phone">

    <img src="{% static 'images/Lego-logo.png' %}" class="logo" alt="Lego logo">

    <h1 class="title">Construye tu soluci√≥n</h1>

    {% include "desafio_badge.html" %}

    <h2 class="subtitle">Estas son las ideas que generaste</h2>

    <ul id="ideasList" class="ideas-list"></ul>

    <p class="body">Ahora usa las piezas de LEGO para construir tu soluci√≥n.</p>

    <!-- üîä AUDIO DE ALARMA -->
    <audio id="alarm-audio" src="{% static 'sounds/alarma.mp3' %}" preload="auto"></audio>

    <div id="timer" class="timer">00:15</div>

    <div id="modal-fin" class="modal">
      <div class="modal-content">
        <h2>Tiempo terminado</h2>
        <p>El tiempo para construir ha terminado.</p>
        <button id="buttonContinuar">Continuar</button>
      </div>
    </div>

  </main>

  <!-- ===========================
       CARGAR DATOS DEL BUBBLE MAP
       =========================== -->
  <script>
    const STORAGE_KEY = "bubblemap_data";
    const list = document.getElementById("ideasList");

    const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    if (!saved || Object.values(saved).every(v => !v.trim())) {
      list.innerHTML = "<li>No se ingresaron ideas.</li>";
    } else {
      Object.values(saved).forEach(text => {
        if (text.trim()) {
          const li = document.createElement("li");
          li.textContent = text;
          list.appendChild(li);
        }
      });
    }
  </script>

  <!-- ===========================
       TIMER + ALARMA
       =========================== -->
  <script>
    const alarmAudio = document.getElementById("alarm-audio");
    let timeLeft = 15;
    const timerElement = document.getElementById('timer');

    function updateTimer() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timerElement.textContent =
        `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;

      if (timeLeft > 0) {
        timeLeft--;
      } else {
        clearInterval(timerInterval);

        // üîä Reproducir alarma al terminar
        try {
          alarmAudio.currentTime = 0;
          alarmAudio.play();
        } catch (e) {
          console.warn("No se pudo reproducir la alarma:", e);
        }

        // Mostrar modal
        document.getElementById("modal-fin").style.display = "flex";
      }
    }

    const timerInterval = setInterval(updateTimer, 1000);
    updateTimer();

    document.getElementById("buttonContinuar").addEventListener("click", () => {
      window.location.href = "{% url 'transicioncomunicacion' %}";
    });
  </script>

</body>
</html>
