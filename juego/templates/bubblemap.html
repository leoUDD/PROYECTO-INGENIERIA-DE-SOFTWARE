{% load static %}
{% include "atajos.html" %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MisiÃ³n Emprende UDD â€” Bubble Map</title>
  <link rel="stylesheet" href="{% static 'css/estilo_bubblemap.css' %}">
</head>
<body>
  <main class="bubblemap-container">
    <h1>ðŸ’­ Bubble Map â€” Genera tus ideas</h1>
    <p class="subtitle">Escribe palabras clave relacionadas con tu persona del desafÃ­o.</p>

    {% include "desafio_badge.html" %}

    <section class="bubbles">

      <!-- Bubble central con GIF funcionando -->
      <div class="bubble central">
        <img src="{% static 'images/triste.gif' %}" alt="Persona">
      </div>

      <div class="bubble"><textarea placeholder="Â¿QuÃ© le gusta?"></textarea></div>
      <div class="bubble"><textarea placeholder="Â¿QuÃ© siente?"></textarea></div>
      <div class="bubble"><textarea placeholder="Â¿QuÃ© obstÃ¡culos tiene?"></textarea></div>
      <div class="bubble"><textarea placeholder="Â¿QuÃ© dicen los demÃ¡s?"></textarea></div>
      <div class="bubble"><textarea placeholder="Hobbies"></textarea></div>
      <div class="bubble"><textarea placeholder="Otros"></textarea></div>

    </section>

    <footer class="footer-actions">
      <button id="btnContinuar" class="btn primary">Continuar</button>
    </footer>
  </main>

  <script>
    const STORAGE_KEY = "bubblemap_data";
    const SESSION_KEY = "browser_session_id";

    const currentSession = sessionStorage.getItem("my_session_id") ||
                           crypto.randomUUID();
    sessionStorage.setItem("my_session_id", currentSession);

    const lastSession = localStorage.getItem(SESSION_KEY);
    if (lastSession && lastSession !== currentSession) {
      localStorage.removeItem(STORAGE_KEY);
    }
    localStorage.setItem(SESSION_KEY, currentSession);

    const bubbles = document.querySelectorAll(".bubble textarea");
    const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    bubbles.forEach((area, i) => { if (saved[i]) area.value = saved[i]; });

    bubbles.forEach((area, i) => {
      area.addEventListener("input", () => {
        const data = {};
        bubbles.forEach((a, idx) => data[idx] = a.value.trim());
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      });
    });

    document.getElementById("btnContinuar").addEventListener("click", () => {
      window.location.href = "{% url 'transicioncreatividad' %}";
    });
  </script>
</body>
</html>
