{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Misión Emprende UDD — Grupos</title>

  <link rel="stylesheet" href="{% static 'css/estilo_registraralumnos.css' %}">
  <style>
    .card {
      background:#fff;
      padding:20px;
      border-radius:12px;
      margin-bottom:28px;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
    }
    .table { width:100%; border-collapse:collapse; }
    .table th, .table td {
      padding:10px;
      border-bottom:1px solid #e5e7eb;
      text-align:left;
      font-size:14px;
    }
    .table th { background:#f9fafb; font-weight:600; }

    .btn-auto{
      display:inline-block;
      padding:10px 16px;
      border-radius:999px;
      border:none;
      background:#2563eb;
      color:#fff;
      font-weight:600;
      cursor:pointer;
      margin-bottom:20px;
    }
    .btn-auto:hover{
      filter:brightness(1.05);
      transform:translateY(-1px);
    }

    .messages{ list-style:none; padding:0; margin:10px 0 20px; }
    .messages li{ margin-bottom:4px; font-size:14px; }

    /* Bloque resumen de códigos */
    .codes-summary{
      background:#f9fafb;
      border-radius:12px;
      padding:14px 16px;
      margin-bottom:24px;
      border:1px solid #e5e7eb;
      font-size:14px;
    }
    .codes-summary h2{
      font-size:16px;
      margin-bottom:8px;
      font-weight:600;
    }
    .codes-summary ul{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-wrap:wrap;
      gap:6px 18px;
    }
    .codes-summary li strong{
      font-weight:700;
    }
  </style>
</head>

<body>

<div class="dashboard">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-logo"><h2 class="sidebar-title">Dashboard Profesor</h2></div>
    <nav class="sidebar-nav">
      <ul>
        <li><a href="{% url 'dashboardprofesor' %}">Inicio</a></li>
        <li><a href="{% url 'registraralumnos' %}">Registrar alumnos</a></li>
        <li><a class="active" href="{% url 'registrargrupos' %}">Registrar grupos</a></li>
      </ul>
    </nav>
  </aside>

  <main class="main-content">

    <h1 class="title">Grupos / Salas</h1>
    <p class="subtitle">
      Desde aquí puedes auto-asignar a los alumnos sin grupo y ver los códigos
      que deben usar para ingresar a cada grupo.
    </p>

    <form method="post">
      {% csrf_token %}
      <button type="submit" class="btn-auto">Auto-asignar alumnos sin grupo</button>
    </form>

    {% if messages %}
      <ul class="messages">
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if grupos %}
      <section class="codes-summary">
        <h2>Códigos para entregar a los grupos</h2>
        <ul>
          {% for grupo in grupos %}
            <li>
              <strong> {{ grupo.nombregrupo }}:</strong>
              {{ grupo.codigoacceso|default:"(sin código)" }}
            </li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}

    {% for grupo in grupos %}
      <section class="card">
        <h2> {{ grupo.nombregrupo }}</h2>

        <p><strong>Código de ingreso:</strong>
          {{ grupo.codigoacceso|default:"(sin código)" }}
        </p>

        <p><strong>Usuario asignado:</strong> 
          {{ grupo.usuario_idusuario.nombreusuario|default:"—" }}
        </p>
        <p><strong>Tokens:</strong> {{ grupo.tokensgrupo }}</p>
        <p><strong>Etapa:</strong> {{ grupo.etapa|default:"—" }}</p>

        <h3 style="margin-top:20px;">Alumnos en este grupo</h3>

        {% with alumnos=grupo.alumno_set.all %}
          {% if alumnos %}
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Email</th>
                  <th>RUT</th>
                  <th>Carrera</th>
                </tr>
              </thead>

              <tbody>
                {% for a in alumnos %}
                  <tr>
                    <td>{{ a.idalumno }}</td>
                    <td>{{ a.nombrealumno }} {{ a.apellidopaternoalumno }}</td>
                    <td>{{ a.emailalumno }}</td>
                    <td>{{ a.rutalumno }}</td>
                    <td>{{ a.carreraalumno }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p>No hay alumnos en este grupo.</p>
          {% endif %}
        {% endwith %}

      </section>
    {% endfor %}

    {% if not grupos %}
      <p>No hay grupos creados todavía. Presiona “Auto-asignar alumnos sin grupo” para crearlos.</p>
    {% endif %}

  </main>

</div>

</body>
</html>
