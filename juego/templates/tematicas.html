{% load static %}
{% include "atajos.html" %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>MisiÃ³n Emprende UDD â€” Elige la temÃ¡tica</title>
  <link rel="stylesheet" href="{% static 'css/estilo_tematicas.css' %}">
</head>

<body>
  <main class="selector-container" role="main" aria-labelledby="page-title">

    <header class="header">
      <h1 id="page-title">Elige la temÃ¡tica del desafÃ­o</h1>
      <p class="subtitle">Selecciona una categorÃ­a para continuar. Cada bloque explica de quÃ© trata.</p>
    </header>

    <!-- ============================
         CARRUSEL COMPLETO
       ============================ -->
    <section class="themes-carousel" aria-label="TemÃ¡ticas disponibles">

      <button class="carousel-btn prev" type="button" aria-label="Anterior">â€¹</button>

      <div class="themes-track" id="themesTrack">

        <!-- SALUD -->
        <article class="theme-card" tabindex="-1"
                 data-slug="salud"
                 data-url="{% url 'desafios' %}">
          <div class="thumb">
            <img src="{% static 'images/salud.png' %}" alt="Icono de salud">
          </div>
          <div class="content">
            <h2 class="title">Salud</h2>
            <div class="chips">
              <span class="chip">ğŸ«¶ EmpatÃ­a</span>
              <span class="chip">ğŸ’¡ Innovar</span>
              <span class="chip">ğŸ’ª Bienestar</span>
            </div>
            <p class="desc">Mejora hÃ¡bitos y bienestar con soluciones prÃ¡cticas.</p>
          </div>
          <div class="actions">
            <button class="btn select" type="button" onclick="guardarTema('salud')">Elegir</button>
          </div>
        </article>

        <!-- SUSTENTABILIDAD -->
        <article class="theme-card" tabindex="-1"
                 data-slug="sustentabilidad"
                 data-url="{% url 'desafios' %}">
          <div class="thumb">
            <img src="{% static 'images/sustentabilidad.png' %}" alt="Icono de sustentabilidad">
          </div>
          <div class="content">
            <h2 class="title">Sustentabilidad</h2>
            <div class="chips">
              <span class="chip">ğŸŒ± Ambiental</span>
              <span class="chip">â™»ï¸ Reciclaje</span>
              <span class="chip">âš™ï¸ Creativo</span>
            </div>
            <p class="desc">Impacto ambiental positivo con ideas circulares.</p>
          </div>
          <div class="actions">
            <button class="btn select" type="button" onclick="guardarTema('sustentabilidad')">Elegir</button>
          </div>
        </article>

        <!-- EDUCACIÃ“N -->
        <article class="theme-card" tabindex="-1"
                 data-slug="educacion"
                 data-url="{% url 'desafios' %}">
          <div class="thumb">
            <img src="{% static 'images/educacion.png' %}" alt="Icono de educaciÃ³n">
          </div>
          <div class="content">
            <h2 class="title">EducaciÃ³n</h2>
            <div class="chips">
              <span class="chip">ğŸ—£ï¸ Comunicar</span>
              <span class="chip">ğŸ“ Liderazgo</span>
              <span class="chip">ğŸ’­ Ideas</span>
            </div>
            <p class="desc">Aprendizaje inclusivo con propuestas innovadoras.</p>
          </div>
          <div class="actions">
            <button class="btn select" type="button" onclick="guardarTema('educacion')">Elegir</button>
          </div>
        </article>

      </div>

      <button class="carousel-btn next" type="button" aria-label="Siguiente">â€º</button>

    </section>

    <!-- BOTÃ“N FINAL -->
    <footer class="footer-actions">
      <button id="btnContinuar" class="btn primary" type="button" disabled>
        Comenzar desafÃ­o
      </button>
    </footer>

  </main>

  <script src="{% static 'js/tematica.js' %}" defer></script>

  <!-- JS DEL CARRUSEL -->
<script>
  (function(){
    const track = document.getElementById('themesTrack');
    const prev = document.querySelector('.carousel-btn.prev');
    const next = document.querySelector('.carousel-btn.next');

    if (!track) return;

    function move(dir){
      const card = track.querySelector('.theme-card');
      if (!card) return;
      const amount = card.offsetWidth + 24;
      track.scrollBy({ left: dir * amount, behavior: 'smooth' });
    }

    if (prev) prev.addEventListener('click', () => move(-1));
    if (next) next.addEventListener('click', () => move(1));
  })();

  (function () {
    const cta = document.getElementById('btnContinuar');

    function updateCTAState() {
      const tema = localStorage.getItem('temaSeleccionado');
      cta.disabled = !tema;
    }

    // ğŸ”¥ OJO: QUITAMOS estas dos lÃ­neas que rompen todo:
    // if (prev) prev.addEventListener('click', () => move(-1));
    // if (next) next.addEventListener('click', () => move(1));

    cta.addEventListener('click', function () {
      const tema = localStorage.getItem('temaSeleccionado');
      if (!tema) return alert('Selecciona una temÃ¡tica antes de continuar.');
      window.location.href =
        "{% url 'desafios' %}?tema=" + encodeURIComponent(tema);
    });

    updateCTAState();
    window.addEventListener('storage', updateCTAState);
  })();
</script>

</body>
</html>
