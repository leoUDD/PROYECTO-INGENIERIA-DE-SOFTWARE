{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Misión cumplida</title>
  <link rel="stylesheet" href="{% static 'css/estilo_mision_cumplida.css' %}">
</head>
<body>

  <audio id="celebration-sound" src="{% static 'sounds/victory2.mp3' %}" preload="auto"></audio>

  <div class="confetti-container"></div>

  <main class="mission-card">
    <p class="badge">MISIÓN COMPLETADA</p>
    <h1>¡Misión cumplida, agentes!</h1>

    <p class="intro">
      Han completado todos los objetivos de esta misión.<br>
      Es momento de ver cómo quedó el <strong>ranking final de tokens</strong>.
    </p>

    <div class="logo">
      <img src="{% static 'images/logo.gif' %}" alt="Logo misión">
    </div>

    <ul class="highlights">
      <li>✓ Superaron las pruebas de <strong>creatividad, comunicación y trabajo en equipo</strong>.</li>
      <li>✓ Ya se registraron las evaluaciones entre equipos.</li>
      <li>✓ Los equipos están listos para el podio final.</li>
    </ul>

    <a href="{% url 'ranking' %}" class="btn-ranking">Ver ranking final</a>
  </main>

  <script>
  const sound = document.getElementById("celebration-sound");
  sound.volume = 0.6;

  function tryPlay() {
    const promise = sound.play();
    if (promise !== undefined) {
      promise
        .then(() => {
          console.log("Sonido reproducido automáticamente.");
        })
        .catch(() => {
          console.warn("Autoplay bloqueado. Esperando interacción…");
          enableInteractionPlay();
        });
    }
  }

  function enableInteractionPlay() {
    const handler = () => {
      sound.play();
      window.removeEventListener("click", handler);
      window.removeEventListener("touchstart", handler);
      window.removeEventListener("keydown", handler);
      window.removeEventListener("scroll", handler);
    };

    window.addEventListener("click", handler, { once: true });
    window.addEventListener("touchstart", handler, { once: true });
    window.addEventListener("keydown", handler, { once: true });
    window.addEventListener("scroll", handler, { once: true });
  }

  window.addEventListener("load", tryPlay);


    /* ====== CONFETI ====== */
    const container = document.querySelector('.confetti-container');
    const colors = ["#FF7A1A", "#00C8FF", "#E6EEF8", "#8B5CF6", "#34D399"];

    function createConfetti(){
      const confetti = document.createElement("div");
      confetti.classList.add("confetti");
      confetti.style.width = Math.random() * 8 + 6 + "px";
      confetti.style.height = Math.random() * 12 + 8 + "px";
      confetti.style.left = Math.random() * 100 + "vw";
      confetti.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
      confetti.style.animationDelay = (Math.random() * 3) + "s";

      container.appendChild(confetti);
      setTimeout(() => confetti.remove(), 30000);
    }

    let confettiInterval = setInterval(createConfetti, 100);
    setTimeout(() => clearInterval(confettiInterval), 15000);
  </script>

</body>
</html>
