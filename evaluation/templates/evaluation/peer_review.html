<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Evaluación de Proyectos – Cierre</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card shadow-sm">
        <div class="card-body">
          <h1 class="h4 mb-2">Evaluación de Proyectos (Peer Review)</h1>
          <p class="text-muted mb-3">
            Sesión: <strong>{{ session.name }}</strong> · Tu equipo: <strong>{{ evaluator_team.name }}</strong><br>
            Evalúa a otros equipos de forma honesta y respetuosa. No evalúes a tu propio equipo.
          </p>

          {% if submitted %}
            <div class="alert alert-success">¡Evaluación enviada! Gracias por tu aporte.</div>
            <a href="/" class="btn btn-primary">Volver al inicio</a>
          {% else %}
            <form method="post">
              {% csrf_token %}

              <!-- Reflexión breve (opcional) -->
              <div class="mb-4">
                <label class="form-label fw-semibold">Reflexión final (opcional)</label>
                <textarea name="reflection" rows="3" class="form-control" maxlength="500"
                          placeholder="¿Qué aprendiste de los proyectos presentados?"></textarea>
                <div class="form-text">Máx. 500 caracteres.</div>
              </div>

              <!-- Equipo a evaluar -->
              <div class="mb-3">
                <label class="form-label fw-semibold">Equipo a evaluar</label>
                <select name="target_team_id" class="form-select" required>
                  <option value="" selected disabled>Selecciona un equipo</option>
                  {% for team in target_teams %}
                    <option value="{{ team.id }}">{{ team.name }}</option>
                  {% endfor %}
                </select>
              </div>

              <!-- Criterios 1–5 -->
              <div class="border rounded p-3 mb-3">
                <h2 class="h6 mb-3">Criterios (1 = muy bajo, 5 = excelente)</h2>
                {% for c in criteria %}
                  <div class="mb-2">
                    <label class="form-label d-block">{{ c.label }}</label>
                    <div class="d-flex gap-2 flex-wrap">
                      {% for v in "12345" %}
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio"
                               name="score_{{ c.key }}" id="score_{{ c.key }}_{{ v }}" value="{{ v }}" required>
                        <label class="form-check-label" for="score_{{ c.key }}_{{ v }}">{{ v }}</label>
                      </div>
                      {% endfor %}
                    </div>
                  </div>
                {% endfor %}
              </div>

              <!-- Comentario (obligatorio) -->
              <div class="mb-3">
                <label class="form-label fw-semibold">Comentario para el equipo</label>
                <textarea name="comment" rows="3" class="form-control" maxlength="600"
                          placeholder="Fortalezas y sugerencias concretas…" required></textarea>
              </div>

              <!-- Confirmación -->
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="confirm_honesty" name="confirm_honesty" required>
                <label class="form-check-label" for="confirm_honesty">
                  Confirmo que esta evaluación es honesta y no corresponde a mi propio equipo.
                </label>
              </div>

              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">Enviar evaluación</button>
                <a href="/" class="btn btn-outline-secondary">Cancelar</a>
              </div>
            </form>
          {% endif %}

          <hr class="my-4">
          <div class="small text-muted">
            <strong>Reglas:</strong> 1) No evalúes a tu propio equipo. 2) El profesor ve todas las evaluaciones.
            3) Un envío por equipo evaluador y equipo evaluado.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
